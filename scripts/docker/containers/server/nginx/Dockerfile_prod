# ======================================================================================================================
# Dockerfile - Nginx                                                                      https://hub.docker.com/_/nginx
# ======================================================================================================================
ARG NGINX_VERSION

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 01 : Pull official base image 
# ----------------------------------------------------------------------------------------------------------------------
FROM nginx:${NGINX_VERSION}

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 02 : Set environment variables
# ----------------------------------------------------------------------------------------------------------------------
#RUN echo "[ Nginx ] Set environment variables"

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 03 : Set Work directory
# ----------------------------------------------------------------------------------------------------------------------
RUN echo "[ Nginx ] Set Work directory "
# >>>> logs
RUN mkdir -p /var/log/nginx
RUN chmod -R 775 /var/log/nginx

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 04 : Install packages
# ----------------------------------------------------------------------------------------------------------------------
#RUN echo "[ Nginx ] Install packages"

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 05 : Update configuration
# ----------------------------------------------------------------------------------------------------------------------
RUN echo "[ Nginx ] Update configuration"
RUN rm -f /etc/nginx/nginx.conf
RUN rm -f /etc/nginx/conf.d/default.conf
COPY --link scripts/docker/containers/server/nginx/etc/nginx/nginx_dev.conf /etc/nginx/nginx.conf
COPY --link scripts/docker/containers/server/nginx/etc/nginx/conf.d/www_dev.conf /etc/nginx/conf.d/www.conf

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 06 : Copy source files
# ----------------------------------------------------------------------------------------------------------------------
#RUN echo "[ Nginx ] Copy source files"

# ----------------------------------------------------------------------------------------------------------------------
# STEP - 07 : Start the service
# ----------------------------------------------------------------------------------------------------------------------
RUN echo "[ Nginx ] Start the service"
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]